{% extends 'nav.base.html.twig' %}
{% form_theme form 'bootstrap_5_horizontal_layout.html.twig' %}
{% import _self as formMacros %}

{% macro printOperation(operations) %}

	<tr>
		<td>{{ form_widget(operations.Category) }}</td>
		<td>{{ form_widget(operations.Description) }}</td>
		<td>{{ form_widget(operations.Hours, {'attr': {'class': 'opHour'}}) }}</td>
		<td>{{ form_widget(operations.Priority) }}</td>
		<td>{{ form_widget(operations.Status) }}</td>
	</tr>

{% endmacro %}

{% macro printProject(projects) %}

	<tr>
		<td>{{ form_widget(projects.Name) }}</td>
		<td>{{ form_widget(projects.Description) }}</td>
		<td>{{ form_widget(projects.TargetHours, {'attr': {'class': 'projectHour'}}) }}</td>
		<td>{{ form_widget(projects.Priority) }}</td>
		<td>{{ form_widget(projects.Status) }}</td>
	</tr>

{% endmacro %}

{% macro printMisc(misc) %}

	<tr>
		<td>{{ form_widget(misc.Task) }}</td>
		<td>{{ form_widget(misc.Description) }}</td>
		<td>{{ form_widget(misc.TargetHours, {'attr': {'class': 'miscHour'}}) }}</td>
		<td>{{ form_widget(misc.Comment) }}</td>
	</tr>

{% endmacro %}

{% block title %}New Submission
{% endblock %}

{% block content %}

	<div class="mt-3 p-3 container-xl bg-white shadow-sm">

		{{ form_start(form, {'attr': {'oninput': 'totalworkhours.value=parseInt(submission_task_form_submission_Workdays.value)-parseInt(plannedabs.value)-parseInt(furtherabs.value)'}}) }}
		{{ form_errors(form) }}

		<div class="row g-3">
			
			{# General #}
			<div class="container">
				<div class="row row-cols">
					<div class="me-auto col-auto">
						<h1>
							{{ today|date('F') }}
						</h1>
					</div>
					<div class="col-sm-2">
						<div class="input-group">
							<span class="input-group-text">Workdays</span>
							{{ form_widget(form.submission.Workdays) }}
						</div>
						{# {{ form_label(form.submission.Workdays) }} #}
					</div>
					<div class="col-sm-4">
						<div class="input-group">
							<span class="input-group-text">Planned and further absences</span>
							<input class="form-control" min="0" max="42" type="number" id="plannedabs" value="0">
							<input class="form-control" min="0" max="42" type="number" id="furtherabs" value="0">
						</div>
					</div>
					<div class="col-sm-2">
						<div class="input-group">
							<span class="input-group-text">Total Work Hours</span>
							<output class="form-control" id="totalworkhours" name="totalworkhours" for="submission_task_form_submission_Workdays plannedabs furtherabs">0</output>
						</div>
					</div>
				</div>
			</div>

			{# Operations Table #}
			<div class="p-3 border rounded-3" style="background-color: #fcfcfc;">
				<h3>Operations</h3>
				<table class="table table-borderd table-sm border-none">
					<thead>
						<tr>
							<th class="col-2" scope="col">Category</th>
							<th class="col-7" scope="col">Description</th>
							<th class="col-1" scope="col">Hours</th>
							<th class="col-1" scope="col">Priority</th>
							<th class="col-1" scope="col">Status</th>
							<th class="col-1" scope="col"></th>
						</tr>
					</thead>
					<tbody class="operations" data-index="{{ form.operations|length > 0 ? form.operations|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printOperation(form.operations.vars.prototype)|e('html_attr') }}">
						<tr></tr>
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td>
								<input class="form-control" id="opHourSum" type="text" value="0" disabled readonly>
							</td>
							<td></td>
							<td></td>
							<td>
								<button type="button" class="btn btn-success bg-success; add_item_link" data-collection-holder-class="operations">+</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>

			{# Projects Table #}
			<div class="p-3 border rounded-3" style="background-color: #fcfcfc;">
				<h3>Projects</h3>
				<table class="table">
					<thead>
						<tr>
							<th class="col-2" scope="col">Name</th>
							<th class="col-7" scope="col">Description</th>
							<th class="col-1" scope="col">Target Hours</th>
							<th class="col-1" scope="col">Priority</th>
							<th class="col-1" scope="col">Status</th>
							<th class="col-1" scope="col"></th>
						</tr>
					</thead>
					<tbody class="projects" data-index="{{ form.projects|length > 0 ? form.projects|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printProject(form.projects.vars.prototype)|e('html_attr') }}">
						<tr></tr>
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td><input class="form-control" id="projectHourSum" type="text" value="0" disabled readonly></td>
							<td></td>
							<td></td>
							<td>
								<button type="button" class="btn btn-success bg-success; add_item_link" data-collection-holder-class="projects">+</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>

			{# Miscellaneous Table #}
			<div class="p-3 border rounded-3" style="background-color: #fcfcfc;">
				<h3>Others</h3>
				<table class="table">
					<thead>
						<tr>
							<th class="col-3" scope="col">Task</th>
							<th class="col-4" scope="col">Description</th>
							<th class="col-1" scope="col">Target Hours</th>
							<th class="col-4" scope="col">Comment</th>
							<th class="col-1" scope="col"></th>
						</tr>
					</thead>
					<tbody class="miscellaneous" data-index="{{ form.miscellaneous|length > 0 ? form.miscellaneous|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printMisc(form.miscellaneous.vars.prototype)|e('html_attr') }}">
						<tr></tr>
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td><input class="form-control" id="miscHourSum" type="text" value="0" disabled readonly></td>
							<td></td>
							<td>
								<button type="button" class="btn btn-success bg-success; add_item_link" data-collection-holder-class="miscellaneous">+</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>

		<div class="mt-3 d-flex">
			{{ form_widget(form.Submit, {'attr': {'class': 'ms-auto btn btn-lg btn-success'}}) }}
		</div>

		{{ form_end(form) }}
	</div>

{% endblock %}
