{% import _self as formMacros %}
{% form_theme form 'bootstrap_5_horizontal_layout.html.twig' %}
{% macro printOperation(operations) %}

	<tr>
		<td>{{ form_widget(operations.Category, {'attr': {'disabled': 'disabled'}}
			) }}</td>
		<td>{{ form_widget(operations.Description, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(operations.Hours, {'attr': {'class': 'opHour', 'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(operations.Priority, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(operations.Status, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(operations.WorkResults, {'attr': {'disabled': 'disabled'}}) }}</td>
	</tr>

{% endmacro %}

{% macro printProject(projects) %}

	<tr>
		<td>{{ form_widget(projects.Name, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.Description, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.TargetHours, {'attr': {'class': 'projectHour', 'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.ActualHours, {'attr': {'class': 'projectActualHour', 'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.Priority, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.Status, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(projects.WorkResults, {'attr': {'disabled': 'disabled'}}) }}</td>
	</tr>

{% endmacro %}

{% macro printMisc(misc) %}

	<tr>
		<td>{{ form_widget(misc.Task, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(misc.Description, {'attr': {'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(misc.TargetHours, {'attr': {'class': 'miscHour', 'disabled': 'disabled'}}) }}</td>
		<td>{{ form_widget(misc.Comment, {'attr': {'disabled': 'disabled'}}) }}</td>
	</tr>

{% endmacro %}

{% block javascripts %}
	{{ encore_entry_script_tags('submission') }}
	<script>
		function calcSubmission() {
totalworkhours.value = Number(8.4 * ((parseFloat(submission_form_Workdays.value) || 0) - (parseFloat(submission_form_PlannedAbsences.value) || 0) - (parseFloat(submission_form_FurtherAbsences.value) || 0))).toFixed(2)
hourstoplan.value = Number((parseFloat(totalworkhours.value) || 0) * 0.8).toFixed(2)
opHourTarget.value = Number((parseFloat(hourstoplan.value) || 0) * 0.6).toFixed(2)
projectHourTarget.value = Number((parseFloat(hourstoplan.value) || 0) * 0.4).toFixed(2)
}
	</script>

	<body onload="calcSubmission()">

	{% endblock %}


	<div
		class="row g-3">

		{# General #}
		<div class="container">
			<div class="row row-cols">
				<div class="me-auto col">
					<h1>
						{{ subMonth|date('F Y') }}
					</h1>
					{{ form_start(form, {'attr': {'oninput': 'calcSubmission()'} }) }}
					{{ form_errors(form) }}
				</div>

				<div class="col-sm-auto">
					<label for="submission_task_form_submission_Workdays" class="form-label">Workdays</label>
					{{ form_widget(form.Workdays, {'attr': {'disabled': 'disabled'}}) }}
				</div>
				<div class="col-sm-auto">
					<label for="submission_task_form_submission_PlannedAbsences" class="form-label">Planned
																																																																								absences</label>
					{{ form_widget(form.PlannedAbsences, {'attr': {'disabled': 'disabled'}}) }}
				</div>
				<div class="col-sm-auto">
					<label for="submission_task_form_submission_FurtherAbsences" class="form-label">Further
																																																																								absences</label>
					{{ form_widget(form.FurtherAbsences, {'attr': {'disabled': 'disabled'}}) }}
				</div>
				<div class="col-sm-auto">
					<div class="row">
						<div class="col">
							<div class="input-group" style="width: max-content;">
								<span class="input-group-text bg-light" style="width: 10rem;">Total hours work</span>
								<output class="form-control text-end" style="width: 5em;" id="totalworkhours" name="totalworkhours" for="submission_task_form_submission_Workdays submission_task_form_submission_PlannedAbsences submission_task_form_submission_FurtherAbsences"></output>
							</div>
							<div class="mt-1 input-group" style="width: max-content;">
								<span class="input-group-text bg-light" style="width: 10rem;">Hours to plan</span>
								<output class="form-control text-end" style="width: 5em;" id="hourstoplan" for="totalworkhours"></output>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		{# Operations Table #}
		<div class="p-1 border rounded-3" style="background-color: #fcfcfc;">
			<div class="table-responsive">
				<table class="table table-sm table-borderless">
					<thead class="border-bottom">
						<tr>
							<th class="col" scope="col">
								<h3>Operations</h1>
							</th>
							<th class="col text-end" scope="col">Target</th>
							<th class="col" scope="col">
								<output name="result" id="opHourTarget" for="hourstoplan">0</output>
							</th>
							<th class="col" scope="col"></th>
							<th class="col" scope="col"></th>
							<th class="col" scope="col"></th>
						</tr>
						<tr>
							<th class="col" scope="col">Category</th>
							<th class="col-7" scope="col">Description</th>
							<th class="col" scope="col">Hours</th>
							<th class="col" scope="col">Priority</th>
							<th class="col" scope="col">Status</th>
							<th class="col" scope="col">Work Results</th>
						</tr>
					</thead>
					<tbody class="operations" data-index="{{ form.operations|length > 0 ? form.operations|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printOperation(form.operations.vars.prototype)|e('html_attr') }}">
						<tr></tr>
						{% for operation in form.operations %}
							{{ formMacros.printOperation(operation) }}
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td>
								<input class="form-control" id="opHourSum" type="text" value="0" style="width: 5em;" disabled readonly>
							</td>
							<td>
								<div style="width: 7em;"></div>
							</td>
							<td>
								<div style="width: 6em;"></div>
							</td>
							<td>
								<div style="width: 20em;"></div>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>

		{# Projects Table #}
		<div class="p-1 border rounded-3" style="background-color: #fcfcfc;">
			<div class="table-responsive">
				<table class="table table-sm table-borderless">
					<thead class="border-bottom">
						<tr>
							<th class="col" scope="col">
								<h3>Projects</h3>
							</th>
							<th class="col text-end" scope="col">Target</th>
							<th class="col" scope="col">
								<output name="result" id="projectHourTarget" for="hourstoplan" style="width: 5em;">0</output>
							</th>
							<th class="col" scope="col">Actual</th>
							<th class="col" scope="col"></th>
							<th class="col" scope="col"></th>
							<th class="col" scope="col"></th>
							<th class="col" scope="col"></th>
						</tr>
						<tr>
							<th class="col" scope="col">Name</th>
							<th class="col-8" scope="col">Description</th>
							<th class="col" scope="col">Hours</th>
							<th class="col" scope="col">Hours</th>
							<th class="col" scope="col">Priority</th>
							<th class="col" scope="col">Status</th>
							<th class="col" scope="col">Work Results</th>
						</tr>
					</thead>
					<tbody class="projects" data-index="{{ form.projects|length > 0 ? form.projects|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printProject(form.projects.vars.prototype)|e('html_attr') }}">
						<tr></tr>
						{% for project in form.projects %}
							{{ formMacros.printProject(project) }}
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td>
								<input class="form-control" id="projectHourSum" type="text" value="0" style="width: 5em;" disabled readonly>
							</td>
							<td>
								<input class="form-control" id="projectActualHourSum" type="text" value="0" style="width: 5em;" disabled readonly>
							</td>
							<td>
								<div style="width: 7em;"></div>
							</td>
							<td>
								<div style="width: 6em;"></div>
							</td>
							<td>
								<div style="width: 20em;"></div>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>

		{# miscellaneouses Table #}
		<div class="pt-1 border rounded-3" style="background-color: #fcfcfc;">

			<div class="table-responsive">
				<table class="table table-sm table-borderless">
					<thead class="border-bottom">
						<tr>
							<th>
								<h3>Others</h3>
							</th>
						</tr>
						<tr>
							<th class="col-3" scope="col">Task</th>
							<th class="col-5" scope="col">Description</th>
							<th class="col" scope="col">Hours</th>
							<th class="col-5" scope="col">Comment</th>
						</tr>
					</thead>
					<tbody class="miscellaneouses" data-index="{{ form.miscellaneouses|length > 0 ? form.miscellaneouses|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.printMisc(form.miscellaneouses.vars.prototype)|e('html_attr') }}">
						<tr></tr>
						{% for misc in form.miscellaneouses %}
							{{ formMacros.printMisc(misc) }}
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<td></td>
							<td></td>
							<td><input class="form-control" id="miscHourSum" type="text" value="0" style="width: 5em;" disabled readonly>
							</td>
							<td></td>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>
	{{ form_end(form) }}

	<div class="row row-cols-auto justify-content-end me-1">
		<form action="{{ path('edit_submission') }}" method="PUT">
			<div>
				<input type="hidden" id="year" name="year" value="{{ year }}">
				<input type="hidden" id="month" name="month" value="{{ month }}">
			</div>
			<div>
				<button type="submit" class="btn btn btn-outline-warning">Edit</button>
			</div>
		</form>
		{{ include('submission/_delete.modal.html.twig') }}
	</div>

</body>
